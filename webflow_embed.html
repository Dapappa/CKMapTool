<!-- Google Font -->
<link
  href="https://fonts.googleapis.com/css2?family=Bangers&display=swap"
  rel="stylesheet"
/>

<!-- External CSS (via jsDelivr) -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/gh/Dapappa/CKMapTool/styles.css"
/>

<!-- Adding inline styles to ensure visibility -->
<style>
  .zone-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    justify-content: center;
    align-items: center;
  }

  .zone-modal.active {
    display: flex !important;
  }

  .modal-content {
    background-color: #fff;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  }

  .image-slider img {
    max-width: 100%;
    max-height: 60vh;
    display: block;
    margin: 0 auto;
  }

  .slider-container {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    min-height: 200px;
  }
</style>

<div class="map-container">
  <!-- The main map with image map areas -->
  <div class="map-wrapper">
    <!-- Note the URL-encoded space: City%20Map.svg -->
    <img
      src="https://cdn.jsdelivr.net/gh/Dapappa/CKMapTool/City%20Map.svg"
      usemap="#image-map"
      class="main-map"
    />
    <div class="zone-label"></div>

    <!-- Initial overlay with tap instructions -->
    <div class="initial-overlay">
      <div class="instruction-text">Tap a region to explore</div>
    </div>
  </div>

  <map name="image-map">
    <area
      target="_self"
      alt="NorthWestAreaA"
      title="NorthWestAreaA"
      href="#"
      coords="116,639,284,638,287,558,296,552,295,543,287,533,284,500,291,497,274,485,322,476,373,475,369,408,289,357,277,382,221,410,243,425,225,441,203,445,187,456,137,451,125,456"
      shape="poly"
    />
    <area
      target="_self"
      alt="NorthWestAreaB"
      title="NorthWestAreaB"
      href="#"
      coords="73,226,71,353,126,357,115,405,210,439,232,423,217,408,264,383,284,357,298,337,299,304,317,284,322,275,319,258,299,248,289,236,283,228,229,225,133,222"
      shape="poly"
    />
    <area
      target="_self"
      alt="NorthWestAreaC"
      title="NorthWestAreaC"
      href="#"
      coords="227,142,225,174,243,182,248,205,246,218,285,224,296,234,301,242,310,249,319,254,322,269,321,282,330,292,338,292,345,290,354,294,371,312,385,330,393,351,406,346,420,349,446,348,456,344,457,320,455,303,418,274,419,260,428,248,432,234,419,221,417,208,417,196,421,179,424,169,439,163,449,159,457,154,456,126,454,99,379,99,378,137"
      shape="poly"
    />
    <area
      target="_self"
      alt="NorthEastAreaC"
      title="NorthEastAreaC"
      href="#"
      coords="425,171,480,161,485,140,601,141,605,163,651,166,644,190,647,215,519,221,458,301,420,272,428,256,434,239,427,220,419,215"
      shape="poly"
    />
    <area
      target="_self"
      alt="NorthEastAreaB"
      title="NorthEastAreaB"
      href="#"
      coords="522,229,648,229,649,263,676,271,692,282,699,353,700,387,697,416,694,441,695,475,504,472,500,449,492,436,487,428,480,417,478,394,468,370,469,297,474,280,512,235,517,233"
      shape="poly"
    />
    <area
      target="_self"
      alt="NorthEastAreaA"
      title="NorthEastAreaA"
      href="#"
      coords="503,481,692,482,691,530,701,533,700,544,691,557,676,559,652,561,650,574,630,580,607,583,572,585,529,574"
      shape="poly"
    />
    <area
      target="_self"
      alt="SouthEastAreaA"
      title="SouthEastAreaA"
      href="#"
      coords="542,582,541,589,532,597,529,612,529,631,523,642,504,661,502,677,510,698,494,702,483,722,488,760,500,788,519,799,539,804,546,791,556,725,583,721,644,716,673,722,688,718,694,718,693,643,629,638,628,596,616,588"
      shape="poly"
    />
    <area
      target="_self"
      alt="SouthEastAreaB"
      title="SouthEastAreaB"
      href="#"
      coords="602,1085,619,1046,643,1037,662,1018,719,995,721,939,700,874,694,745,669,752,643,772,625,771,623,735,560,733,550,796,545,812,527,814,537,844,559,847,569,858,569,875,574,886,566,910,561,926,557,933,554,947,556,976,563,1002,562,1020,570,1043,592,1080,595,1084"
      shape="poly"
    />
    <area
      target="_self"
      alt="SouthWestAreaB"
      title="SouthWestAreaB"
      href="#"
      coords="371,866,446,897,495,941,510,968,545,999,547,1016,509,1021,512,1033,526,1043,548,1061,578,1063,601,1091,594,1101,515,1099,464,1033,437,1032,423,1021,383,1017,375,987,335,976,317,960,310,940,308,920,305,896,302,884,335,887,348,894"
      shape="poly"
    />
    <area
      target="_self"
      alt="SouthWestAreaA"
      title="SouthWestAreaA"
      href="#"
      coords="291,850,309,858,328,854,335,858,350,845,358,846,383,840,399,846,410,855,424,860,461,866,494,905,513,914,532,904,553,897,532,865,533,846,521,834,519,813,499,798,484,763,466,740,457,726,418,729,414,691,368,691,375,727,374,748,360,746,347,744,334,745,321,745,308,740,291,735"
      shape="poly"
    />
    <area
      target="_self"
      alt="DowntownAreaB"
      title="DowntownAreaB"
      href="#"
      coords="284,489,298,500,293,519,299,544,297,565,291,599,321,588,345,564,524,567,497,479,496,458,477,426,473,390,458,356,411,353,396,360,378,385,377,405,380,418,378,445,379,459,382,474,328,479,303,482"
      shape="poly"
    />
    <area
      target="_self"
      alt="DowntownAreaA"
      title="DowntownAreaA"
      href="#"
      coords="420,675,420,723,454,721,470,736,492,698,501,695,495,677,497,662,502,655,515,645,521,633,524,622,526,608,526,595,537,587,526,580,519,573,345,568,324,591,288,604,289,631,291,643,290,671,297,690,328,691,325,666,342,665,351,654,352,644,372,639,385,642,392,652,372,652,380,665,376,676,381,682,411,683"
      shape="poly"
    />
  </map>
</div>

<!-- The zone modal for displaying images -->
<div class="zone-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title"></h2>
      <button class="close-button">&times;</button>
    </div>
    <div class="modal-body">
      <div class="image-slider">
        <div class="slider-container">
          <!-- Images will be loaded here dynamically -->
        </div>
        <button class="prev-button">&larr;</button>
        <button class="next-button">&rarr;</button>
      </div>
    </div>
  </div>
</div>

<!-- Full screen image view -->
<div class="fullscreen-view">
  <button class="close-fullscreen">&times;</button>
  <div class="fullscreen-image-container">
    <!-- Fullscreen image will be loaded here -->
  </div>
</div>

<!-- External JS (via jsDelivr) -->
<script
  src="https://cdn.jsdelivr.net/gh/Dapappa/CKMapTool/script.js"
  defer
></script>

<!-- Add responsive image map handling for mobile devices - improved scaling -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get the map image and all area elements
    const mapImage = document.querySelector(".main-map");
    const areas = document.querySelectorAll("area");

    // For debugging touch points (set to true to see touch markers)
    const SHOW_TOUCH_POINTS = false;

    // Store original map dimensions for accurate scaling
    let originalWidth, originalHeight;

    // Store original coordinates for each area
    areas.forEach((area) => {
      // Save original coords as a data attribute
      area.setAttribute("data-original-coords", area.getAttribute("coords"));
    });

    // Enhanced coordinate scaling function with aspect ratio preservation
    function scaleCoordinates() {
      if (!mapImage) return;

      // Get the current dimensions of the map image
      const currentWidth = mapImage.clientWidth;
      const currentHeight = mapImage.clientHeight;

      // Get the natural dimensions of the image (only once)
      if (!originalWidth || !originalHeight) {
        originalWidth = mapImage.naturalWidth || 800;
        originalHeight = mapImage.naturalHeight || 1200;
        console.log(
          `Original map dimensions: ${originalWidth}x${originalHeight}`
        );
      }

      // Calculate scaling factors
      const widthFactor = currentWidth / originalWidth;
      const heightFactor = currentHeight / originalHeight;

      console.log(
        `Map scaled: ${widthFactor.toFixed(4)}x width, ${heightFactor.toFixed(
          4
        )}x height`
      );

      // Fix for mobile devices - additional adjustment for better vertical accuracy on tall screens
      const isMobile = window.innerWidth < 768;
      const mobileHeightAdjustment = isMobile ? 1.0 : 1.0; // Adjust this value if needed

      // Apply scaling to each area with special handling for mobile
      areas.forEach((area) => {
        const originalCoords = area.getAttribute("data-original-coords");

        // Skip if we don't have original coordinates
        if (!originalCoords) return;

        // Split coordinates into array of numbers
        const coords = originalCoords.split(",").map(Number);

        // Scale each coordinate with precise math
        const scaledCoords = coords.map((coord, index) => {
          // Even indices (0, 2, 4...) are X coordinates, scale by width
          // Odd indices (1, 3, 5...) are Y coordinates, scale by height
          if (index % 2 === 0) {
            return Math.round(coord * widthFactor);
          } else {
            return Math.round(coord * heightFactor * mobileHeightAdjustment);
          }
        });

        // Set the new scaled coordinates
        area.setAttribute("coords", scaledCoords.join(","));
      });

      // Add touch indicator if enabled
      if (SHOW_TOUCH_POINTS) {
        setupTouchDebugging();
      }
    }

    // Function to display touch points for debugging
    function setupTouchDebugging() {
      const mapWrapper = document.querySelector(".map-wrapper");
      if (!mapWrapper) return;

      // Create or get touch indicator
      let touchIndicator = document.getElementById("touch-indicator");
      if (!touchIndicator) {
        touchIndicator = document.createElement("div");
        touchIndicator.id = "touch-indicator";
        touchIndicator.style.position = "absolute";
        touchIndicator.style.width = "20px";
        touchIndicator.style.height = "20px";
        touchIndicator.style.borderRadius = "50%";
        touchIndicator.style.backgroundColor = "rgba(255, 0, 0, 0.5)";
        touchIndicator.style.transform = "translate(-50%, -50%)";
        touchIndicator.style.pointerEvents = "none";
        touchIndicator.style.zIndex = "1000";
        mapWrapper.appendChild(touchIndicator);
      }

      // Show touch indicator where touches occur
      mapImage.addEventListener("touchstart", function (e) {
        e.preventDefault(); // Prevent double-tap zoom
        const touch = e.touches[0];
        const rect = mapImage.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;

        touchIndicator.style.left = x + "px";
        touchIndicator.style.top = y + "px";
        touchIndicator.style.display = "block";

        console.log(`Touch at: ${x}, ${y}`);
      });
    }

    // Initial scaling
    if (mapImage) {
      if (mapImage.complete) {
        // Use requestAnimationFrame for more accurate timing
        requestAnimationFrame(scaleCoordinates);
      } else {
        mapImage.onload = function () {
          requestAnimationFrame(scaleCoordinates);
        };
      }
    }

    // Handle window resize with debounce
    let resizeTimer;
    window.addEventListener("resize", function () {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(function () {
        requestAnimationFrame(scaleCoordinates);
      }, 100);
    });

    // Handle orientation change
    window.addEventListener("orientationchange", function () {
      // Wait for the orientation change to finish
      setTimeout(function () {
        requestAnimationFrame(scaleCoordinates);
      }, 300);
    });
  });
</script>

<!-- Enhance carousel with swipe support and better mobile styling -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Add improved mobile styling
    const style = document.createElement("style");
    style.textContent = `
      /* Mobile-optimized carousel */
      @media (max-width: 767px) {
        .modal-content {
          width: 95%;
          max-width: 95%;
          max-height: 80vh;
        }
        
        .modal-title {
          font-size: 18px;
          padding: 10px;
        }
        
        .slider-container {
          min-height: 250px;
        }
        
        .prev-button, .next-button {
          width: 50px;
          height: 50px;
          font-size: 24px;
          background: rgba(0, 0, 0, 0.7);
          color: white;
          border: none;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 5px;
        }
        
        /* Swipe hint animation */
        .swipe-hint {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background-color: rgba(0, 0, 0, 0.6);
          color: white;
          padding: 10px 15px;
          border-radius: 20px;
          font-size: 14px;
          opacity: 0;
          transition: opacity 0.3s;
          pointer-events: none;
          z-index: 10;
        }
        
        .swipe-hint.show {
          opacity: 1;
          animation: fadeInOut 2s ease-in-out;
        }
        
        @keyframes fadeInOut {
          0% { opacity: 0; }
          20% { opacity: 1; }
          80% { opacity: 1; }
          100% { opacity: 0; }
        }
      }
      
      /* Carousel transitions */
      .slider-fade {
        animation: fadeIn 0.3s ease;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
    `;
    document.head.appendChild(style);

    // Add swipe functionality to carousel
    function setupSwipeNavigation() {
      const zoneModal = document.querySelector(".zone-modal");
      if (!zoneModal) return;

      // Create swipe hint element
      const swipeHint = document.createElement("div");
      swipeHint.className = "swipe-hint";
      swipeHint.textContent = "Swipe to view more";

      // Touch tracking variables
      let startX, startY, endX, endY;
      let minSwipeDistance = 50; // Minimum distance to trigger swipe

      // Show the swipe hint when a carousel with multiple images opens
      function showSwipeHint() {
        const sliderContainer = document.querySelector(".slider-container");
        if (!sliderContainer) return;

        const zoneTitle = sliderContainer.dataset.zoneTitle;
        const images = zoneImageMap[zoneTitle] || [];

        // Only show hint if there are multiple images
        if (images.length > 1) {
          sliderContainer.appendChild(swipeHint);
          swipeHint.classList.add("show");

          // Remove hint after animation
          setTimeout(() => {
            swipeHint.classList.remove("show");
          }, 2000);
        }
      }

      // Swipe navigation handler
      function handleSwipe(direction) {
        const sliderContainer = document.querySelector(".slider-container");
        if (!sliderContainer) return;

        const zoneTitle = sliderContainer.dataset.zoneTitle;
        let currentIndex = parseInt(sliderContainer.dataset.currentIndex || 0);
        const images = zoneImageMap[zoneTitle] || [];

        if (images.length <= 1) return;

        // Determine next index based on swipe direction
        if (direction === "left") {
          currentIndex = (currentIndex + 1) % images.length;
        } else if (direction === "right") {
          currentIndex = (currentIndex - 1 + images.length) % images.length;
        }

        sliderContainer.dataset.currentIndex = currentIndex.toString();

        // Update image with animation
        sliderContainer.innerHTML =
          '<div style="text-align: center; padding: 20px;">Loading image...</div>';

        const img = new Image();
        img.src = images[currentIndex];
        img.alt = formatZoneTitle(zoneTitle);
        img.className = "slider-fade";

        img.onload = function () {
          sliderContainer.innerHTML = "";
          sliderContainer.appendChild(img);

          // Make image clickable for fullscreen
          img.style.cursor = "zoom-in";
          img.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();

            const fullscreenView = document.querySelector(".fullscreen-view");
            const fullscreenContainer = document.querySelector(
              ".fullscreen-image-container"
            );

            fullscreenContainer.innerHTML = "";
            fullscreenContainer.appendChild(img.cloneNode());
            fullscreenView.style.display = "flex";
          });
        };

        img.onerror = function () {
          sliderContainer.innerHTML =
            '<div style="text-align: center; padding: 20px;">Failed to load image</div>';
        };
      }

      // Register touch event handlers on modal
      zoneModal.addEventListener(
        "touchstart",
        function (e) {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
        },
        { passive: true }
      );

      zoneModal.addEventListener(
        "touchend",
        function (e) {
          if (!startX) return;

          endX = e.changedTouches[0].clientX;
          endY = e.changedTouches[0].clientY;

          // Calculate distance and direction
          const diffX = endX - startX;
          const diffY = endY - startY;

          // Only trigger if horizontal swipe is greater than vertical and meets minimum distance
          if (
            Math.abs(diffX) > Math.abs(diffY) &&
            Math.abs(diffX) > minSwipeDistance
          ) {
            const direction = diffX > 0 ? "right" : "left";
            handleSwipe(direction);
          }

          // Reset values
          startX = startY = endX = endY = null;
        },
        { passive: true }
      );

      // Show hint when modal opens
      const observer = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
          if (
            mutation.attributeName === "class" &&
            zoneModal.classList.contains("active")
          ) {
            setTimeout(showSwipeHint, 500);
          }
        });
      });

      observer.observe(zoneModal, { attributes: true });
    }

    // Initialize swipe navigation
    setupSwipeNavigation();
  });
</script>

<!-- Fallback script to ensure functionality -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Make sure zone modal can be activated
    const areas = document.querySelectorAll("area");
    const zoneModal = document.querySelector(".zone-modal");
    const closeButton = document.querySelector(".close-button");

    // Define image paths with exact filenames from the repository
    const zoneImageMap = {
      NorthWestAreaA: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152ca79e102efac06d9c_Northwest%20Calgary%20Distribution%20Map%20(3)-1.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152cf32904d35d17f639_Northwest%20Calgary%20Distribution%20Map%20(3)-2.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152d08ea1ae1f650e810_Northwest%20Calgary%20Distribution%20Map%20(3)-3.png",
      ],
      NorthWestAreaB: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152ca79e102efac06d9c_Northwest%20Calgary%20Distribution%20Map%20(3)-1.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152cf32904d35d17f639_Northwest%20Calgary%20Distribution%20Map%20(3)-2.png",
      ],
      NorthWestAreaC: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152d08ea1ae1f650e810_Northwest%20Calgary%20Distribution%20Map%20(3)-3.png",
      ],
      NorthEastAreaA: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152c2d59410587b5d1bf_North%20East-1.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152ce965c5b385b91dbc_North%20East-2.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152d32c401d798b756d5_North%20East-3.png",
      ],
      NorthEastAreaB: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152c2d59410587b5d1bf_North%20East-1.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152ce965c5b385b91dbc_North%20East-2.png",
      ],
      NorthEastAreaC: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152d32c401d798b756d5_North%20East-3.png",
      ],
      DowntownAreaA: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce1656df0450fd7aa4d763_Downtown%20Calgary%20Map%20(1)-1.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce16564099212dfea6b2b2_Downtown%20Calgary%20Map%20(1)-2.png",
      ],
      DowntownAreaB: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce1656df0450fd7aa4d763_Downtown%20Calgary%20Map%20(1)-1.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce16564099212dfea6b2b2_Downtown%20Calgary%20Map%20(1)-2.png",
      ],
      SouthEastAreaA: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67c1d2b874833dd5316b3ca8_South%20East%20Completed-2.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67c1d2b874833dd5316b3ca8_South%20East%20Completed-2.png",
      ],
      SouthEastAreaB: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67c1d2b874833dd5316b3ca8_South%20East%20Completed-2.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67c1d2b874833dd5316b3ca8_South%20East%20Completed-2.png",
      ],
      SouthWestAreaA: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152c3c238822c45316cd_Southwest%20Map%20(2)-1.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152c530f75df6093d3d7_Southwest%20Map%20(2)-2.png",
      ],
      SouthWestAreaB: [
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152c3c238822c45316cd_Southwest%20Map%20(2)-1.png",
        "https://cdn.prod.website-files.com/64d572ccd997a626d3de38d6/67ce152c530f75df6093d3d7_Southwest%20Map%20(2)-2.png",
      ],
    };

    // Helper function to format zone titles for display
    function formatZoneTitle(title) {
      return title
        .replace(/([A-Z])/g, " $1")
        .replace(/^./, (str) => str.toUpperCase())
        .trim();
    }

    // Basic click handlers for map areas
    areas.forEach((area) => {
      area.addEventListener("click", function (e) {
        e.preventDefault();

        // Get zone title from the area
        const zoneTitle = this.getAttribute("title");
        console.log("Clicked zone:", zoneTitle);

        // Set modal title
        document.querySelector(".modal-title").textContent =
          formatZoneTitle(zoneTitle);

        // Clear previous images
        const sliderContainer = document.querySelector(".slider-container");
        sliderContainer.innerHTML = "";

        // Add images if available for this zone
        if (zoneImageMap[zoneTitle]) {
          const images = zoneImageMap[zoneTitle];

          // Only proceed if we have images
          if (images && images.length > 0) {
            // Add first image with simple loading
            sliderContainer.innerHTML =
              '<div style="text-align: center; padding: 20px;">Loading image...</div>';

            const img = new Image();
            img.src = images[0];
            img.alt = formatZoneTitle(zoneTitle);
            img.className = "slider-fade";

            img.onload = function () {
              sliderContainer.innerHTML = "";
              sliderContainer.appendChild(img);
              console.log("Image loaded successfully:", images[0]);

              // Make image clickable
              img.style.cursor = "zoom-in";
              img.addEventListener("click", function (e) {
                e.preventDefault();
                e.stopPropagation();

                const fullscreenView =
                  document.querySelector(".fullscreen-view");
                const fullscreenContainer = document.querySelector(
                  ".fullscreen-image-container"
                );

                fullscreenContainer.innerHTML = "";
                const clonedImg = img.cloneNode();
                fullscreenContainer.appendChild(clonedImg);
                fullscreenView.style.display = "flex";
              });
            };

            img.onerror = function () {
              console.error("Failed to load image:", images[0]);
              sliderContainer.innerHTML =
                '<div style="text-align: center;">Image failed to load</div>';
            };

            // Store current image index and zone info
            sliderContainer.dataset.currentIndex = "0";
            sliderContainer.dataset.zoneTitle = zoneTitle;

            // Show/hide navigation buttons based on number of images
            const prevButton = document.querySelector(".prev-button");
            const nextButton = document.querySelector(".next-button");

            if (images.length > 1) {
              prevButton.style.display = "block";
              nextButton.style.display = "block";
            } else {
              prevButton.style.display = "none";
              nextButton.style.display = "none";
            }
          }
        }

        // Show modal
        zoneModal.classList.add("active");
      });
    });

    // Close button
    closeButton.addEventListener("click", function () {
      zoneModal.classList.remove("active");
    });

    // Prevent closing when clicking inside the modal content
    document
      .querySelector(".modal-content")
      .addEventListener("click", function (e) {
        e.stopPropagation();
      });

    // Close when clicking the background
    zoneModal.addEventListener("click", function (e) {
      if (e.target === this) {
        zoneModal.classList.remove("active");
      }
    });

    // Close on ESC key
    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape" && zoneModal.classList.contains("active")) {
        zoneModal.classList.remove("active");
      }
    });
  });
</script>
